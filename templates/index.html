<!DOCTYPE html> 
<html lang="en">
  <!-- Last Updated: 2025-06-12 by lim bada -->
  <!-- [Head] start -->

  <head>
    <title>Cymechs | Health Monitoring System</title>
    <!-- [Meta] -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Able Pro is trending dashboard template made using Bootstrap 5 design framework. Able Pro is available in Bootstrap, React, CodeIgniter, Angular,  and .net Technologies.">
    <meta name="keywords" content="Bootstrap admin template, Dashboard UI Kit, Dashboard Template, Backend Panel, react dashboard, angular dashboard">
    <meta name="author" content="Phoenixcoded">

    <!-- [Favicon] icon -->
    <link rel="icon" href="{{ url_for('static', filename='assets/images/image.png') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/fonts/inter/inter.css') }}" id="main-font-link" />
    <!-- [Tabler Icons] https://tablericons.com -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/fonts/tabler-icons.min.css') }}">

    <!-- [Feather Icons] https://feathericons.com -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/fonts/feather.css') }}">
    <!-- [Font Awesome Icons] https://fontawesome.com/icons -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/fonts/fontawesome.css') }}">
    <!-- [Material Icons] https://fonts.google.com/icons -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/fonts/material.css') }}">
    <!-- [Template CSS Files] -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}" id="main-style-link">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/style-preset.css') }}">
  </head>
  <!-- [Head] end -->
  <!-- [Body] Start -->

  <body data-pc-preset="preset-1" data-pc-sidebar-caption="true" data-pc-layout="vertical" data-pc-direction="ltr" data-pc-theme_contrast="" data-pc-theme="light">
    <!-- [ Pre-loader ] start -->
<div class="loader-bg">
  <div class="loader-track">
    <div class="loader-fill"></div>
  </div>
</div>
<!-- [ Pre-loader ] End -->
<!-- [ Sidebar Menu ] start -->
<nav class="pc-sidebar">
  <div class="navbar-wrapper">
    <div class="m-header">
      <a href="{{ url_for('dashboard') }}" class="b-brand text-primary">
        <!-- ========   Change your logo from here   ============ -->
        <img src="{{ url_for('static', filename='assets/images/cymechs.svg') }}" class="img-fluid logo-lg" alt="logo">
        <span class="badge bg-light-success rounded-pill ms-2 theme-version">v2.5.0</span>
      </a>
    </div>
    <div class="navbar-content">
      <div class="card pc-user-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <img src="{{ url_for('static', filename='assets/images/user/avatar-6.jpg') }}" alt="user-image" class="user-avtar wid-45 rounded-circle" />
            </div>
            <div class="flex-grow-1 ms-3 me-2">
              <h6 class="mb-0">Cymechs User</h6>
              <small>R&D center</small>
            </div>
            <a class="btn btn-icon btn-link-secondary avtar" data-bs-toggle="collapse" href="#pc_sidebar_userlink">
              <svg class="pc-icon">
                <use xlink:href="#custom-sort-outline"></use>
              </svg>
            </a>
          </div>
          <div class="collapse pc-user-links" id="pc_sidebar_userlink">
            <div class="pt-3">
              <a href="#!">
                <i class="ti ti-user"></i>
                <span>My Account</span>
              </a>
              <a href="#!">
                <i class="ti ti-settings"></i>
                <span>Settings</span>
              </a>
              <a href="#!">
                <i class="ti ti-lock"></i>
                <span>Lock Screen</span>
              </a>
              <a href="#!">
                <i class="ti ti-power"></i>
                <span>Logout</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- [ Sidebar Menu ] start  -->
      <ul class="pc-navbar">
        <li class="pc-item pc-caption">
          <label>Navigation</label>
        </li>
        <!-- Dashboard 토글 -->
        <li class="pc-item pc-hasmenu">
          <a href="#!" class="pc-link">
            <span class="pc-micon"><svg class="pc-icon"><use xlink:href="#custom-box-1"></use></svg></span>
            <span class="pc-mtext">Dashboard</span>
            <span class="pc-arrow"><i data-feather="chevron-right"></i></span>
          </a>
          <ul class="pc-submenu">
            <li class="pc-item"><a href="{{ url_for('monitoring') }}" class="pc-link">Monitoring</a></li>
            <li class="pc-item"><a href="{{ url_for('maintenance') }}" class="pc-link">Maintenance</a></li>
          </ul>
        </li>
        <!-- Authentication 토글 -->
        <li class="pc-item pc-hasmenu">
          <a href="#!" class="pc-link">
            <span class="pc-micon"><svg class="pc-icon"><use xlink:href="#custom-shield"></use></svg></span>
            <span class="pc-mtext">Authentication</span>
            <span class="pc-arrow"><i data-feather="chevron-right"></i></span>
          </a>
          <ul class="pc-submenu">
            <li class="pc-item"><a href="{{ url_for('login') }}" class="pc-link" target="_blank">Login</a></li>
            <li class="pc-item"><a href="{{ url_for('register') }}" class="pc-link" target="_blank">Register</a></li>
          </ul>
        </li>
        <!-- Health Monitoring 토글 -->
        <li class="pc-item pc-hasmenu">
          <a href="#!" class="pc-link">
            <span class="pc-micon"><svg class="pc-icon"><use xlink:href="#custom-box-1"></use></svg></span>
            <span class="pc-mtext">Health Monitoring</span>
            <span class="pc-arrow"><i data-feather="chevron-right"></i></span>
          </a>
          <ul class="pc-submenu">
            <li class="pc-item"><a href="{{ url_for('maxTorque') }}" class="pc-link">Max Torque</a></li>
            <li class="pc-item"><a href="{{ url_for('minTorque') }}" class="pc-link">Min Torque</a></li>
            <li class="pc-item"><a href="{{ url_for('maxDuty') }}" class="pc-link">Max Duty</a></li>
            <li class="pc-item"><a href="{{ url_for('maxPoserr') }}" class="pc-link">Max Position Error</a></li>
            <li class="pc-item"><a href="{{ url_for('gripOntime') }}" class="pc-link">Grip On Time</a></li>
            <li class="pc-item"><a href="{{ url_for('inrangeTime') }}" class="pc-link">Inrange Time</a></li>
            <li class="pc-item"><a href="{{ url_for('movingTime') }}" class="pc-link">Moving Time</a></li>
          </ul>
        </li>
        <!-- PDM 및 기타 -->
        <!--
        <li class="pc-item">
          <a href="{{ url_for('Pdm') }}" class="pc-link">
            <span class="pc-micon"><svg class="pc-icon"><use xlink:href="#custom-clipboard"></use></svg></span>
            <span class="pc-mtext">PDM</span>
          </a>
        </li>
        -->
        <!-- Management 토글 (예시) -->
        <li class="pc-item pc-hasmenu">
          <a href="#!" class="pc-link">
            <span class="pc-micon"><svg class="pc-icon"><use xlink:href="#custom-notification-status"></use></svg></span>
            <span class="pc-mtext">Management</span>
            <span class="pc-arrow"><i data-feather="chevron-right"></i></span>
          </a>
          <ul class="pc-submenu">
            <li class="pc-item"><a href="{{ url_for('masterCode') }}" class="pc-link">Master Code</a></li>
            <li class="pc-item"><a href="{{ url_for('masterCode') }}" class="pc-link">User Information</a></li>
          </ul>
        </li>
      </ul>
      <!-- [ Sidebar Menu ] end -->
    </div>
  </div>
</nav>

<!-- [ Header Topbar ] start -->
<header class="pc-header">
  <div class="header-wrapper"> <!-- [Mobile Media Block] start -->
<div class="me-auto pc-mob-drp">
  <ul class="list-unstyled">
    <!-- ======= Menu collapse Icon ===== -->
    <li class="pc-h-item pc-sidebar-collapse">
      <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
        <i class="ti ti-menu-2"></i>
      </a>
    </li>
    <li class="pc-h-item pc-sidebar-popup">
      <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
        <i class="ti ti-menu-2"></i>
      </a>
    </li>
  </header>

    <!-- [ Main Content ] start -->
    <div class="pc-container">
      <div class="pc-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin: 10px 15px; font-weight: bold;">
          <div id="lastUpdated" style="color: orange;">Last Updated: -</div>
          <div id="envData" style="color: #0d6efd;">온도: - ℃ | 습도: - %</div>
        </div>
        <!-- [ Main Content ] start -->
        <div class="row d-flex flex-wrap">
          <!-- Grip On Time 카드 -->
          <div class="col-lg-4 d-flex flex-column">
            <div class="card h-100">
              <div style="padding : 15px;" class="card-header text-center">
                <h5 style="text-align:center;color :  #0d6efd!important;" class="mb-0">Grip On Time (sec)</h5>
              </div>
              <div class="card-body">
                <table class="table table-bordered" style="width: 100%;">
                  <tbody id="latestGripOnTime"></tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Moving Time 카드 -->
          <div class="col-lg-4 d-flex flex-column">
            <div class="card h-100">
              <div style="padding : 15px;"  class="card-header text-center">
                <h5 style="text-align:center; color :  #0d6efd!important;" class="mb-0">Moving Time (sec)</h5>
              </div>
              <div class="card-body">
                <table class="table table-bordered" style="width: 100%;">
                  <tbody id="latestMovingTime">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Max Inrange Time 카드 -->
          <div class="col-lg-4 d-flex flex-column">
            <div class="card h-100">
              <div style="padding : 15px;" class="card-header text-center ">
                <h5 style="text-align:center; color :  #0d6efd!important;" class="mb-0">Max Inrange Time (sec)</h5>
              </div>
              <div class="card-body">
                <table class="table table-bordered" style="width: 100%;">
                  <tbody id="latestMaxInrangeTime">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Max Torque 카드 -->
          <div class="col-lg-4 d-flex flex-column">
            <div class="card h-100">
              <div style="padding : 15px;" class="card-header text-center">
                <h5 style="text-align:center; color :  #0d6efd!important;" class="mb-0">Max Torque (%)</h5>
              </div>
              <div class="card-body">
                <table class="table table-bordered" style="width: 100%;">
                  <tbody id="latestMaxTorque">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Max Duty 카드 -->
          <div class="col-lg-4 d-flex flex-column">
            <div class="card h-100">
              <div style="padding : 15px;" class="card-header text-center">
                <h5 style="text-align:center; color :  #0d6efd!important;" class="mb-0">Max Duty (%)</h5>
              </div>
              <div class="card-body">
                <table class="table table-bordered" style="width: 100%;">
                  <tbody id="latestMaxDuty">
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Max Position 카드 -->
          <div class="col-lg-4 d-flex flex-column">
            <div class="card h-100">
              <div style="padding : 15px;" class="card-header text-center">
                <h5 style="text-align:center; color :  #0d6efd!important;" class="mb-0">Max Position Error (ecnt)</h5>
              </div>
              <div class="card-body">
                <table class="table table-bordered" style="width: 100%;">
                  <tbody id="latestMaxPosition">
                  </tbody>
                </table>
              </div>
            </div>
          </div>  
        </div>
        <!-- [ Main Content ] end -->
      </div>
    </div>
    
<!-- [Page Specific JS] start -->
<script src="{{ url_for('static', filename='assets/js/plugins/apexcharts.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/pages/dashboard-default.js') }}"></script>
<!-- [Page Specific JS] end -->

<!-- Required JS -->
<script src="{{ url_for('static', filename='assets/js/plugins/popper.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/plugins/simplebar.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/plugins/bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/fonts/custom-font.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/script.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/theme.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/plugins/feather.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/monitoring.js') }}">

<!-- Dashboard page JS -->
<script>
  let intervalId;

  function fetchLatestGripData() {
    // command, stage 필터 제거하고 default 값 설정
    const command = "PICK";   // default command
    const stage = 1;          // default stage 값

    fetch('/api/latest-data', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ command, stage })
    })
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('latestData');
      tbody.innerHTML = `
        <tr><th>Logging Date</th><td>${data.loggingDateTime || '-'}</td></tr>
        <tr><th>Grip On Time</th><td>${data.gripOnTime || '-'}</td></tr>
        <tr><th>Grip Off Time</th><td>${data.gripOffTime || '-'}</td></tr>
        <tr><th>Command</th><td>${data.command || '-'}</td></tr>
        <tr><th>Stage</th><td>${data.stage || '-'}</td></tr>
      `;
    });
  }

  // 초기 로딩 + 3초 주기 갱신
  fetchLatestGripData();
  intervalId = setInterval(fetchLatestGripData, 3000);
</script>

    <script>change_box_container('false');</script>
    <script>layout_caption_change('true');</script>
    <script>layout_rtl_change('false');</script>
    <script>preset_change("preset-1");</script>
    
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='assets/js/chart.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='assets/js/diagnosis_tab.js') }}"></script>
</body>
  <!-- [Body] end -->
</html>
